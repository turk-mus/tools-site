<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="google-adsense-account" content="ca-pub-6286972152122784">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>أسعار اليوم السعودية | الذهب، الوقود، الحاسبات</title>
  <meta name="description" content="موقع أسعار اليوم السعودية يوفر لك أحدث أسعار الذهب والوقود في السعودية، إلى جانب حاسبات ذكية مثل الزكاة والعمر وتحويل التاريخ." />
  <meta name="keywords" content="أسعار الذهب, أسعار الوقود, أسعار البنزين, حاسبة الزكاة, تحويل التاريخ, حاسبة العمر, السعودية, أسعار اليوم" />
  <meta name="author" content="أسعار اليوم السعودية" />

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-D8W8C8PYS9"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-D8W8C8PYS9');
  </script>

  <!-- Tajawal font -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">

<style>
  body {
    font-family: 'Tajawal', sans-serif;
    background-color: #f5f5f5;
    margin: 0;
    padding: 0;
    color: #333;
    transition: background 0.3s, color 0.3s;
  }

  /* يمنع تجاوز العرض داخل الشبكة */
  *, *::before, *::after { box-sizing: border-box; }

  .dark-mode {
    background-color: #121212;
    color: #e0e0e0;
  }

  .container {
    max-width: 900px;
    margin: auto;
    padding: 20px;
    text-align: center;
  }

  h1 {
    color: #006c35;
    margin-bottom: 10px;
    font-size: 26px;
  }

  .dark-mode h1 { color: #6ef19d; }

  p.description {
    font-size: 18px;
    color: #555;
    margin-bottom: 30px;
    line-height: 1.8;
  }

  .dark-mode p.description { color: #bbb; }

  .top-bar { text-align: left; padding: 10px 20px; }

  .toggle-btn {
    background: #006c35;
    color: white;
    border: none;
    border-radius: 20px;
    padding: 8px 15px;
    cursor: pointer;
    font-size: 14px;
  }

  .info-boxes {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 20px;
    margin-bottom: 30px;
  }

  .info-box {
    flex: 1 1 300px;
    background-color: #ffffff;
    border: 2px solid #eeeeee;
    border-radius: 10px;
    padding: 15px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    text-align: right;
  }

  .dark-mode .info-box { background-color: #1e1e1e; border-color: #444; }

  .info-box h3 { margin: 0 0 10px; color: #006c35; }
  .dark-mode .info-box h3 { color: #6ef19d; }

  .info-box ul { list-style: none; padding: 0; margin: 0; }
  .info-box li { padding: 5px 0; border-bottom: 1px solid #eee; font-size: 15px; }
  .dark-mode .info-box li { border-color: #444; }

  /* ===== الأزرار (زرّين بكل صف) ===== */
  .buttons{
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    column-gap: 10px;
    row-gap: 10px;
  }

  .btn{
    display: flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    min-height: 44px;         /* أصغر من السابق لتقليل الارتفاع */
    padding: 10px 12px;       /* تقليل الحشوة */
    line-height: 1.2;
    background-color: #fff;
    border: 1.5px solid #006c35; /* أنحف */
    border-radius: 10px;
    text-decoration: none;
    color: #006c35;
    font-size: 16px;          /* أصغر قليلاً */
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    transition: all 0.2s ease;
    cursor: pointer;
    white-space: nowrap;      /* يمنع نزول السطر */
    overflow: hidden;         /* يخفي الزيادة */
    text-overflow: ellipsis;  /* نقاط عند طول النص */
  }

  .btn:hover { background-color: #006c35; color: #fff; }

  .dark-mode .btn {
    background-color: #1e1e1e;
    color: #6ef19d;
    border-color: #6ef19d;
  }
  .dark-mode .btn:hover { background-color: #6ef19d; color: #000; }

  /* === Hashtags card ONLY === */
  .hashtags-card .row{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid rgba(0,0,0,.06)}
  .dark-mode .hashtags-card .row{border-bottom:1px solid rgba(255,255,255,.06)}
  .hashtags-list{list-style:none;margin:0;padding:0}
  .hashtags-list li{padding:6px 0;border-bottom:1px solid rgba(0,0,0,.06)}
  .dark-mode .hashtags-list li{border-bottom:1px solid rgba(255,255,255,.06)}
  .hash-link{color:#006c35;text-decoration:none;font-weight:700}
  .hash-link:hover{text-decoration:underline}
  .dark-mode .hash-link{color:#6ef19d}
  .muted{font-size:12px;opacity:.75}

  /* بطاقات عامة (طقس/أخبار/هاشتاقات...) */
  .card{border-radius:18px;background:#fff;box-shadow:0 6px 18px rgba(0,0,0,.06);padding:18px; margin-bottom:22px;}
  .dark-mode .card{background:#1c1c1c}
</style>


</head>
<body>
  <div class="top-bar">
    <button class="toggle-btn" onclick="toggleDarkMode()">🌓 وضع ليلي</button>
  </div>

  <div class="container">
    <h1>📌 مرحبًا بك في موقع أسعار اليوم السعودية</h1>
    <p class="description">
  أحدث أسعار <strong>الذهب</strong> و<strong>الوقود</strong> في السعودية، مع تحديثات سريعة لـ<strong>الأخبار</strong> و<strong>الطقس</strong> و<strong>ترندات المملكة</strong> و<strong>نتائج المباريات</strong>. نوفر أيضًا أدوات مفيدة مثل <strong>حاسبة الزكاة</strong> و<strong>حاسبة العمر</strong> و<strong>تحويل التاريخ</strong> و<strong>ضريبة القيمة المضافة</strong> و<strong>حاسبة التقاعد</strong>.
</p>


    <!-- ✅ صندوق أسعار الذهب والديناميكية -->
    <div class="info-boxes">
      <div class="info-box">
        <h3>💰 أسعار الذهب</h3>
        <ul id="gold-prices">
          <li>جاري تحميل الأسعار...</li>
        </ul>
        <div style="text-align:left; margin-top:10px;">
          <a href="gold.html" class="btn" style="font-size:14px; padding:6px 10px;">مزيد ➝</a>
        </div>
      </div>

      <div class="info-box">
        <h3>⛽ أسعار الوقود</h3>
        <ul>
          <li>بنزين 91: 2.18 ريال</li>
          <li>بنزين 95: 2.33 ريال</li>
          <li>ديزل: 0.75 ريال</li>
        </ul>
        <div style="text-align:left; margin-top:10px;">
          <a href="fuel.html" class="btn" style="font-size:14px; padding:6px 10px;">مزيد ➝</a>
        </div>
      </div>
    </div>

<!-- العملات الرقمية -->
<div class="card">
  <div class="weather-header">
    <div class="weather-title">العملات الرقمية</div>
    <button id="cryptoRefresh" class="weather-btn">تحديث</button>
  </div>
  <ul id="crypto-list"><li>—</li></ul>
  <div class="weather-meta">آخر تحديث: <span id="crypto-updated">—</span></div>
</div>

<!-- مربع الأخبار في الرئيسية -->
<section class="card" id="news-card" dir="rtl" lang="ar" style="margin-top:22px;">
  <div class="weather-header" style="display:flex;justify-content:space-between;align-items:center">
    <div class="weather-title">الأخبار</div>
    <button class="weather-btn" style="cursor:pointer" onclick="location.href='news.html'">المزيد</button>
  </div>

  <ul id="news-list" class="news-list" style="list-style:none;padding:0;margin:6px 0 0 0;display:flex;flex-direction:column;gap:10px;">
    <li>جاري التحميل…</li>
  </ul>

  <div class="updated" style="margin-top:8px;font-size:12px;color:#777">
    آخر تحديث: <span id="news-updated">—</span>
  </div>
</section>

<section class="card" id="saudi-matches-box" dir="rtl" lang="ar" style="margin-top:22px">
  <div class="weather-header" style="display:flex;justify-content:space-between;align-items:center">
    <div class="weather-title">نتائج دوري روشن السعودي</div>
    <button class="weather-btn" style="cursor:pointer" onclick="location.href='matches.html'">المزيد</button>
  </div>

  <div id="saudi-matches" style="margin-top:8px">جاري التحميل…</div>
  <div class="updated" style="margin-top:8px;font-size:12px;color:#777">
    آخر تحديث: <span id="sa-updated">—</span>
  </div>
</section>

<script>
(async function(){
  const $list = document.getElementById('saudi-matches');
  const $upd  = document.getElementById('sa-updated');

  async function load(){
    $list.textContent = 'جاري التحميل…';

    try {
      const res = await fetch('/.netlify/functions/saudi-matches');
      const data = await res.json();

      const block = (title, arr, isPast) => `
        <div style="margin-top:10px;font-weight:bold">${title}</div>
        ${arr.slice(0,2).map(m => `
          <div style="display:flex;justify-content:space-between;align-items:center;border:1px solid #eee;padding:6px;border-radius:8px;margin-top:6px">
            <span>${m.home}</span>
            <strong>${isPast && m.homeScore!=null && m.awayScore!=null 
              ? `${m.homeScore} - ${m.awayScore}` 
              : "VS"}</strong>
            <span>${m.away}</span>
          </div>
        `).join("")}
      `;

      $list.innerHTML = block("المباراتان السابقتان", data.past, true) + block("المباراتان القادمتان", data.next, false);
      $upd.textContent = new Date(data.updated_at).toLocaleString('ar-SA');
    } catch (err) {
      $list.textContent = 'حدث خطأ أثناء جلب البيانات.';
    }
  }

  load();
})();
</script>



    <!-- ✅ صندوق الترندات (مضاف فقط) -->
    <section class="card hashtags-card" id="x-trends" dir="rtl" lang="ar" style="margin-top:22px;">
      <div class="row" style="border-bottom:none; padding:0;">
        <h3 style="margin:0;color:#006c35"># أعلى 10 ترندات في منصة X</h3>
        <button id="refreshTrends" class="weather-btn" aria-label="تحديث الترندات">تحديث</button>
      </div>
      <ul id="trends-list" class="hashtags-list">
        <li>جاري التحميل...</li>
      </ul>
      <p id="trends-foot" class="muted" style="margin-top:6px"></p>
    </section>

    <!-- ====== Salaries Card (no API) ====== -->
    <style>
      .salary-card .row{display:flex;align-items:center;justify-content:space-between;padding:8px 0;border-bottom:1px solid rgba(0,0,0,.06)}
      .dark-mode .salary-card .row{border-bottom:1px solid rgba(255,255,255,.06)}
      .salary-name{font-weight:700}
      .salary-date{font-size:13px;color:#666}
      .dark-mode .salary-date{color:#aaa}
      .salary-left{font-weight:700}
      .salary-actions{display:flex;gap:8px}
      .salary-btn{background:#006c35;color:#fff;border:none;border-radius:16px;padding:6px 10px;cursor:pointer}
      .salary-btn:hover{background:#008f4c}
    </style>

    <div class="card salary-card" dir="rtl" lang="ar">
      <div class="weather-header">
        <div>
          <div class="weather-title">الرواتب</div>
          <div class="weather-meta">أقرب موعدين للصرف</div>
        </div>
        <div class="salary-actions">
          <button class="salary-btn" id="goSalaries">عرض جدول الرواتب</button>
        </div>
      </div>

      <div class="row">
        <div>
          <div class="salary-name">موظفو الحكومة</div>
          <div class="salary-date" id="sal1-date">—</div>
        </div>
        <div class="salary-left" id="sal1-left">— يوم</div>
      </div>

      <div class="row" style="border-bottom:none;">
        <div>
          <div class="salary-name">المتقاعدون</div>
          <div class="salary-date" id="sal2-date">—</div>
        </div>
        <div class="salary-left" id="sal2-left">— يوم</div>
      </div>

      <div class="weather-meta">آخر تحديث: <span id="sal-updated">—</span></div>
    </div>

    <script>
    (() => {
      const GOV_DAY  = 27; // الموظفون الحكوميون: يوم 27 ميلادي
      const RET_DAY  = 1; // المتقاعدون: يوم 1 ميلادي

      const el = id => document.getElementById(id);
      const sal1Date = el('sal1-date'), sal1Left = el('sal1-left');
      const sal2Date = el('sal2-date'), sal2Left = el('sal2-left');
      const updEl = el('sal-updated');

      function nextPayday(dayOfMonth){
        const now = new Date();
        const d = new Date(now.getFullYear(), now.getMonth(), dayOfMonth, 0, 0, 0);
        if (isNaN(d.getTime()) || d < startOfDay(now)) {
          const next = new Date(now.getFullYear(), now.getMonth()+1, dayOfMonth, 0, 0, 0);
          return isNaN(next.getTime()) ? lastValidDayOfMonth(next.getFullYear(), next.getMonth()) : next;
        }
        return d;
      }
      function startOfDay(dt){ return new Date(dt.getFullYear(), dt.getMonth(), dt.getDate(), 0, 0, 0); }
      function daysBetween(a, b){ const ms = startOfDay(b) - startOfDay(a); return Math.max(0, Math.round(ms / 86400000)); }
      function lastValidDayOfMonth(y, m){ return new Date(y, m + 1, 0); }
      function fmtDateAr(d){ return d.toLocaleDateString('ar-EG', { weekday:'long', year:'numeric', month:'long', day:'numeric' }); }

      function render(){
        const now = new Date();
        const gov = nextPayday(GOV_DAY);
        const ret = nextPayday(RET_DAY);

        sal1Date.textContent = fmtDateAr(gov) + ' (27 من كل شهر)';
        sal2Date.textContent = fmtDateAr(ret) + ' (1 من كل شهر)';

        sal1Left.textContent = daysBetween(now, gov) + ' يوم';
        sal2Left.textContent = daysBetween(now, ret) + ' يوم';

        updEl.textContent = now.toLocaleString('ar-EG', { hour12:false });
      }

      document.getElementById('goSalaries').addEventListener('click', () => {
        window.location.href = 'salaries.html';
      });

      render();
    })();
    </script>

<section class="card" id="holidays-card" dir="rtl" lang="ar" style="margin-top:22px;">
  <div class="weather-header" style="display:flex;justify-content:space-between;align-items:center">
    <div class="weather-title">أقرب إجازة دراسية</div>
    <button class="weather-btn" style="cursor:pointer" onclick="location.href='holidays.html'">المزيد</button>
  </div>

  <div id="next-holiday" style="margin-top:8px">جاري التحميل…</div>

  <div class="updated" style="margin-top:8px;font-size:12px;color:#777">
    آخر تحديث: <span id="hol-updated">—</span>
  </div>
</section>
<!-- ملف البيانات -->
<script src="/assets/holidays-data.js"></script>

<script>
  function fmtRange(s,e){
    const opt = { year:'numeric', month:'2-digit', day:'2-digit' };
    const a = new Date(s), b = new Date(e);
    const g = d => d.toLocaleDateString('ar-SA', opt);
    return (g(a) === g(b)) ? g(a) : (g(a) + ' — ' + g(b));
  }
  function leftDays(s){
    const ms = 86400000;
    const t = new Date(); t.setHours(0,0,0,0);
    const d = new Date(s); d.setHours(0,0,0,0);
    return Math.ceil((d - t) / ms);
  }
  function getUpcoming(list){
    const today = new Date(); today.setHours(0,0,0,0);
    return (list||[])
      .filter(h => new Date(h.end || h.start) >= today)
      .sort((a,b) => new Date(a.start) - new Date(b.start));
  }

  function renderNextHoliday(){
    try{
      const data = window.HOLIDAYS || [];
      const upcoming = getUpcoming(data);
      const box = document.getElementById('next-holiday');
      const upd = document.getElementById('hol-updated');

      if (upd && window.HOLIDAYS_UPDATED_AT) {
        upd.textContent = new Date(window.HOLIDAYS_UPDATED_AT).toLocaleString('ar-SA', { hour12:false });
      }

      if (!upcoming.length){ box.textContent = 'لا توجد إجازات قريبة.'; return; }

      const h = upcoming[0];
      const days = leftDays(h.start);
      const note = days > 0 ? `تبقّى ${days} يوم` : (days === 0 ? 'اليوم' : '');
      box.innerHTML = `
        <div style="font-weight:700;line-height:1.4">${h.title}</div>
        <div style="font-size:12px;color:#666">${fmtRange(h.start, h.end)}${note ? ' • ' + note : ''}</div>
      `;
    }catch(e){
      console.error(e);
      document.getElementById('next-holiday').textContent = 'تعذّر تحميل الإجازات.';
    }
  }
  document.addEventListener('DOMContentLoaded', renderNextHoliday);
</script>


    <!-- ====== Weather Card (no API key) ====== -->
    <style>
      .weather-card{display:flex;flex-direction:column;gap:10px}
      .weather-header{display:flex;justify-content:space-between;align-items:center}
      .weather-title{font-weight:700;color:#006c35}
      .dark-mode .weather-title{color:#6ef19d}
      .weather-meta{font-size:12px;color:#777}
      .dark-mode .weather-meta{color:#aaa}
      .weather-main{display:flex;align-items:center;gap:12px}
      .weather-icon{font-size:30px}
      .weather-temp{font-size:28px;font-weight:700}
      .weather-sub{display:flex;gap:10px;color:#555;font-size:13px}
      .dark-mode .weather-sub{color:#bbb}
      .weather-btn{background:#006c35;color:#fff;border:none;border-radius:16px;padding:6px 10px;cursor:pointer}
      .weather-btn:hover{background:#008f4c}
    </style>

    <div class="card weather-card" id="weather-card" dir="rtl" lang="ar">
      <div class="weather-header">
        <div>
          <div class="weather-title">الطقس الآن</div>
          <div class="weather-meta" id="weather-city">—</div>
        </div>
        <div style="display:flex; gap:5px;">
          <button class="weather-btn" id="unitBtn" aria-label="تبديل وحدة القياس">°C</button>
          <button class="weather-btn" id="goWeather" aria-label="الذهاب لصفحة الطقس">صفحة الطقس</button>
        </div>
      </div>

      <div class="weather-main">
        <div class="weather-icon" id="weather-icon">⛅</div>
        <div>
          <div class="weather-temp"><span id="temp">--</span>°<span id="unit">C</span></div>
          <div class="weather-sub">
            <span id="desc">—</span>
            <span>•</span>
            <span>رياح: <span id="wind">--</span> كم/س</span>
          </div>
        </div>
      </div>

      <div class="weather-meta">آخر تحديث: <span id="wx-updated">—</span></div>
    </div>

<script>
(() => {
  const el = id => document.getElementById(id);
  const cityEl = el('weather-city'), tempEl = el('temp'), unitEl = el('unit'),
        iconEl = el('weather-icon'), descEl = el('desc'), windEl = el('wind'), updEl = el('wx-updated'),
        unitBtn = el('unitBtn');

  // افتراضي: الرياض
  let coords = { lat: 24.7136, lon: 46.6753 };
  cityEl.textContent = 'الرياض، السعودية';

  let useF = false;
  let lastTempC = null, lastWind = null, lastDesc = '—', lastIcon = '⛅';
  let lastLat = null, lastLon = null;
  let geoWatchId = null;
  let lastFetchAbort = null; // 👈 لإلغاء الطلبات السابقة

  const codeMap = {
    0:['صحو','☀️'],1:['صافٍ غالبًا','🌤️'],2:['غائم جزئيًا','⛅'],3:['غائم','☁️'],
    45:['ضباب','🌫️'],48:['ضباب','🌫️'],51:['رذاذ خفيف','🌦️'],53:['رذاذ','🌦️'],55:['رذاذ كثيف','🌧️'],
    61:['مطر خفيف','🌧️'],63:['مطر','🌧️'],65:['مطر غزير','🌧️'],
    66:['مطر متجمد','🌨️'],67:['مطر متجمد','🌨️'],71:['ثلج خفيف','❄️'],73:['ثلج','❄️'],75:['ثلج كثيف','❄️'],
    77:['حبات جليد','🌨️'],80:['زخات خفيفة','🌦️'],81:['زخات','🌧️'],82:['زخات قوية','🌧️'],
    85:['زخات ثلج','❄️'],86:['زخات ثلج قوية','❄️'],95:['عواصف رعدية','⛈️'],96:['عواصف مع بَرَد','⛈️'],99:['عواصف مع بَرَد كثيف','⛈️']
  };
  const wx = code => codeMap[code] || ['الطقس','🌡️'];

  function updateDisplay() {
    if (lastTempC == null) return;
    const t = useF ? Math.round(lastTempC * 9/5 + 32) : Math.round(lastTempC);
    tempEl.textContent = t;
    unitEl.textContent = useF ? 'F' : 'C';
    unitBtn.textContent = useF ? '°C' : '°F';
    iconEl.textContent = lastIcon;
    descEl.textContent = lastDesc;
    if (lastWind != null) windEl.textContent = Math.round(lastWind);
    updEl.textContent = new Date().toLocaleString("ar-EG", { hour12:false });
  }

 async function reverseGeocode(lat, lon) {
  try {
    const base = 'https://as3aralywm.com'; // مسار مطلق للدومين المباشر
    const r = await fetch(`${base}/.netlify/functions/revgeo?lat=${lat}&lon=${lon}&lang=ar`, { cache: 'no-store' });
    if (!r.ok) return null;
    const j = await r.json();
    const g = j?.results?.[0];
    if (!g) return null;
    return [g.name, g.admin1 || g.country].filter(Boolean).join('، ');
  } catch {
    return null;
  }
}

  async function load(lat, lon) {
    try {
      if (cityEl.textContent === 'الرياض، السعودية') cityEl.textContent = 'جاري تحديد موقعك…';

      // الغِ أي طلب سابق قبل بدء طلب جديد
      if (lastFetchAbort) { try { lastFetchAbort.abort(); } catch {} }
      lastFetchAbort = new AbortController();

      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&timezone=auto`;
      const res = await fetch(url, { cache: 'no-store', signal: lastFetchAbort.signal });
      if (!res.ok) throw new Error('open-meteo ' + res.status);

      const data = await res.json();
      const cw = data.current_weather;
      if (!cw) throw new Error('No current weather');

      const [d, ic] = wx(cw.weathercode);
      lastDesc = d; lastIcon = ic;
      lastWind = cw.windspeed;
      lastTempC = cw.temperature;
      updateDisplay();

      // اسم المدينة (اختياري)
      reverseGeocode(lat, lon).then(nice => {
        if (nice) cityEl.textContent = nice;
        else cityEl.textContent = (lat === 24.7136 && lon === 46.6753)
          ? 'الرياض، السعودية'
          : `${lat.toFixed(2)}, ${lon.toFixed(2)}`;
      }).catch(()=>{});
    } catch (e) {
      console.warn('weather load warn', e);
      if (lastTempC == null) cityEl.textContent = 'تعذّر جلب البيانات';
    }
  }

  if (unitBtn) unitBtn.addEventListener('click', () => { useF = !useF; updateDisplay(); });
  const goBtn = document.getElementById('goWeather');
  if (goBtn) goBtn.addEventListener('click', () => { window.location.href = 'weather.html'; });

  // حمّل الافتراضي مباشرة
  load(coords.lat, coords.lon);

  // ابدأ متابعة الموقع
  function startGeoWatch() {
    if (!navigator.geolocation) return;
    const opts = { enableHighAccuracy:false, timeout:30000, maximumAge:600000 };
    geoWatchId = navigator.geolocation.watchPosition(
      async pos => {
        const { latitude, longitude } = pos.coords;
        if (lastLat !== null && Math.abs(latitude - lastLat) < 0.005 && Math.abs(longitude - lastLon) < 0.005) return;
        lastLat = latitude; lastLon = longitude;
        coords = { lat: latitude, lon: longitude };
        await load(latitude, longitude);
        if (geoWatchId != null) { navigator.geolocation.clearWatch(geoWatchId); geoWatchId = null; }
      },
      err => {
        console.warn('geolocation warn', err);
        // نبقى على الرياض
      },
      opts
    );
  }
  startGeoWatch();

  if (navigator.permissions?.query) {
    navigator.permissions.query({ name: 'geolocation' }).then(p => {
      p.onchange = () => { if (p.state === 'granted' && !geoWatchId) startGeoWatch(); };
    }).catch(()=>{});
  }
})();
</script>



    <div class="buttons">
      <a href="zakat.html" class="btn">🧮 حاسبة الزكاة</a>
      <a href="age.html" class="btn">🎂 حاسبة العمر</a>
      <a href="history.html" class="btn">📅 تحويل بين الهجري والميلادي</a>
      <a href="VAT.html" class="btn">💸 ضريبة القيمة المضافة</a>
      <a href="retirement.html" class="btn">🏦 حاسبة التقاعد</a>
      <a href="/articles/" class="btn">📰 المقالات</a>

    </div>

    <!-- ✅ روابط السياسة والتواصل -->
    <div class="buttons" style="margin-top: 30px;">
      <a href="privacy.html" class="btn">🔐 سياسة الخصوصية</a>
      <a href="terms.html" class="btn">📜 شروط الاستخدام</a>
      <a href="contact.html" class="btn">📬 تواصل معنا</a>
    </div>
  </div>

<script>
async function loadTrends() {
  const list = document.getElementById("trends-list");
  const foot = document.getElementById("trends-foot");
  if (!list || !foot) return;

  list.innerHTML = "<li>جاري التحميل...</li>";
  foot.textContent = "";

  try {
    const r = await fetch('/.netlify/functions/x-trends-cached?country=SA&limit=10', { cache: 'no-store' });
    if (!r.ok) throw new Error("HTTP " + r.status);

    const data = await r.json();               // استجابة الكاش: { country, updated_at, trends: [...] }
    const arr  = Array.isArray(data) ? data : (data.trends || []);
    const updatedAt = data.updated_at ? new Date(data.updated_at) : null;

    list.innerHTML = "";
    if (!arr.length) { list.innerHTML = "<li>لا توجد نتائج حالياً.</li>"; return; }

    arr.forEach((t, i) => {
      const raw = (t.name || "").trim();
      if (!raw) return;
      const label = raw.startsWith("#") ? raw : `#${raw}`;

      const a = document.createElement("a");
      // لو API رجع url كامل سنستخدمه، وإلا نفتح بحث X
      a.href = (t.url && /^https?:\/\//i.test(t.url)) ? t.url : "https://x.com/search?q=" + encodeURIComponent(label);
      a.target = "_blank";
      a.rel = "noopener noreferrer";
      a.className = "hash-link";
      a.textContent = `${i + 1}. ${label.replace(/^#/, "")}`;

      const right = document.createElement("span");
      right.className = "muted";
      if (t.tweet_volume) right.textContent = ` — ${Number(t.tweet_volume).toLocaleString("ar-SA")} تغريدة`;

      const li = document.createElement("li");
      li.style.display = "flex";
      li.style.justifyContent = "space-between";
      li.style.alignItems = "center";
      li.appendChild(a);
      li.appendChild(right);
      list.appendChild(li);
    });

    foot.textContent = updatedAt ? ("آخر تحديث: " + updatedAt.toLocaleString("ar-SA")) : "";
  } catch (e) {
    console.error(e);
    list.innerHTML = "<li>تعذّر جلب الترند الآن.</li>";
    foot.textContent = "تفاصيل: " + (e?.message || "غير معروف");
  }
}

document.addEventListener("DOMContentLoaded", () => {
  document.getElementById("refreshTrends")?.addEventListener("click", loadTrends);
  loadTrends();
  setInterval(loadTrends, 30 * 60 * 1000); // تحديث واجهة فقط
});
</script>



<script>
(() => {
  const list   = document.getElementById('crypto-list');
  const upd    = document.getElementById('crypto-updated');
  const btn    = document.getElementById('cryptoRefresh');

const COIN_IDS = 'bitcoin,ethereum,tether,solana,binancecoin,ripple';
  const nf = new Intl.NumberFormat('ar-SA', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

  async function loadCrypto() {
    if (!list) return;
    list.innerHTML = '<li>جاري التحميل…</li>';
    try {
      const r = await fetch('/.netlify/functions/crypto?ids=' + encodeURIComponent(COIN_IDS), { cache: 'no-store' });
      if (!r.ok) throw new Error('HTTP ' + r.status);
      const arr = await r.json();

      list.innerHTML = '';
      arr.forEach(c => {
        const price = c.priceUSD ?? c.price ?? c.current_price;
        const ch    = c.change24h ?? c.changePercent24h ?? c.price_change_percentage_24h;
        const li = document.createElement('li');
        const chStr = (ch == null) ? '' : ((ch >= 0 ? '▲ ' : '▼ ') + nf.format(ch) + '%');
        li.innerHTML = `<strong>${c.name || c.id}</strong>: ${nf.format(price)} $ <span style="opacity:.8">${chStr}</span>`;
        li.style.color = (ch ?? 0) >= 0 ? '#0a8f55' : '#c0392b';
        list.appendChild(li);
      });

      if (upd) upd.textContent = new Date().toLocaleString('ar-EG', { hour12: false });
    } catch (e) {
      list.innerHTML = '<li>تعذّر الجلب الآن.</li>';
      if (upd) upd.textContent = '';
    }
  }

  btn?.addEventListener('click', loadCrypto);
  loadCrypto();
  // تحديث تلقائي كل 15 دقيقة (الـCDN يغطي الحد)
  setInterval(loadCrypto, 15 * 60 * 1000);
})();
</script>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  const list = document.getElementById('gold-prices');
  if (!list) return;
  list.innerHTML = "<li>جاري التحميل...</li>";

  try {
    const r = await fetch("gold.json", { cache: "no-store" });
    if (!r.ok) throw new Error("HTTP " + r.status);
    const j = await r.json();

    const nf = new Intl.NumberFormat("ar-SA", { minimumFractionDigits: 2, maximumFractionDigits: 2 });

    let g24, g22;

    // استخدم القيم الجاهزة إن وُجدت
    if (j.grams && (j.grams["24"] || j.grams[24])) {
      g24 = Number(j.grams["24"] ?? j.grams[24]);
      g22 = Number(j.grams["22"] ?? j.grams[22]) || (g24 * 22 / 24);
    } else {
      // احسب من الأونصة
      const ex = (j.exchange_rate != null) ? Number(j.exchange_rate) : 3.75;
      const ounceSar = (j.price_ounce_sar != null)
        ? Number(j.price_ounce_sar)
        : (j.price_ounce_usd != null ? Number(j.price_ounce_usd) * ex : null);

      if (ounceSar) {
        const perGram24 = ounceSar / 31.1035;
        g24 = perGram24;
        g22 = perGram24 * 22 / 24;
      }
    }

    if (!g24 || !g22) throw new Error("no data");

    list.innerHTML = `
      <li>عيار 24: ${nf.format(g24)} ريال</li>
      <li>عيار 22: ${nf.format(g22)} ريال</li>
    `;
  } catch (e) {
    console.error(e);
    list.innerHTML = "<li>تعذر تحميل الأسعار</li>";
  }
});
</script>

<script>
async function loadNewsBox() {
  try {
    const res = await fetch('/.netlify/functions/news?limit=4&sfw=1', { cache: 'no-store' });
    if (!res.ok) throw new Error('news http ' + res.status);
    const data = await res.json();

    const list = document.getElementById('news-list');
    if (!list) return;
    list.innerHTML = '';

    (data.items || []).forEach(item => {
      const li = document.createElement('li');
      li.className = 'news-item';
      li.style.borderBottom = '1px solid #eee';
      li.style.paddingBottom = '8px';

      const time = item.pubDate ? new Date(item.pubDate).toLocaleString('ar-SA', { hour12: false }) : '';
      li.innerHTML = `
        <a href="${item.link}" target="_blank" rel="noopener" style="text-decoration:none;color:inherit">
          <div class="news-title" style="font-weight:600;line-height:1.4">${item.title}</div>
          <div class="news-meta" style="font-size:12px;color:#666">${item.source}${time ? ' • ' + time : ''}</div>
        </a>
      `;
      list.appendChild(li);
    });

    const updatedEl = document.getElementById('news-updated');
    if (updatedEl && data.updatedAt) {
      updatedEl.textContent = new Date(data.updatedAt).toLocaleString('ar-SA', { hour12: false });
    }
  } catch (e) {
    console.error('news error', e);
    const list = document.getElementById('news-list');
    if (list) list.innerHTML = '<li>تعذّر تحميل الأخبار الآن.</li>';
  }
}

document.addEventListener('DOMContentLoaded', loadNewsBox);
</script>



</body>
</html>
