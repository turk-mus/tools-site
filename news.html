<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="google-adsense-account" content="ca-pub-6286972152122784">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />  <title>آخر الأخبار</title>
  <meta name="description" content="آخر الأخبار المحلية والعامة من مصادر موثوقة.">
  <link rel="stylesheet" href="styles.css">
  <style>
    body { background:#f7f7f7; font-family: system-ui, -apple-system, Segoe UI, Tahoma; }
    .container { max-width: 980px; margin: 24px auto; padding: 0 12px; }
    .card { background:#fff; border-radius:12px; box-shadow:0 2px 10px rgba(0,0,0,.06); padding:16px; }
    .head { display:flex; align-items:center; justify-content:space-between; gap:10px; }
    .title { font-size:20px; font-weight:700; }
    .btn { border:1px solid #006c35; color:#006c35; background:#fff; padding:8px 12px; border-radius:10px; cursor:pointer; }
    .list { list-style:none; padding:0; margin:14px 0 0 0; display:flex; flex-direction:column; gap:12px; }
    .item { padding:10px 0; border-bottom:1px solid #eee; }
    .item a { color:inherit; text-decoration:none; display:block; }
    .meta { font-size:12px; color:#666; margin-top:4px; }
    .updated { font-size:12px; color:#777; margin:8px 0 6px; }
  </style>
  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-D8W8C8PYS9"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-D8W8C8PYS9');
</script>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="head">
        <div class="title">آخر الأخبار</div>
        <a class="btn" href="home.html" style="text-decoration:none;">العودة للرئيسية</a>
      </div>

      <div id="news-updated" class="updated">آخر تحديث: —</div>
      <ul id="news-list" class="list">
        <li>جاري تحميل الأخبار…</li>
      </ul>
    </div>
  </div>

  <script>
  async function loadNewsPage() {
    try {
      const res = await fetch('/.netlify/functions/news?limit=20&sfw=1', { cache: 'no-store' });
      if (!res.ok) throw new Error('HTTP ' + res.status);
      const data = await res.json();

      const updatedAt = new Date(data.updatedAt).toLocaleString('ar-SA', { hour12:false });
      document.getElementById('news-updated').textContent = 'آخر تحديث: ' + updatedAt;

      const list = document.getElementById('news-list');
      list.innerHTML = '';

      (data.items || []).forEach(i => {
        const li = document.createElement('li');
        li.className = 'item';
        const time = i.pubDate ? new Date(i.pubDate).toLocaleString('ar-SA', { hour12:false }) : '';
        li.innerHTML = `
          <a href="${i.link}" target="_blank" rel="noopener">
            <div style="font-weight:700; line-height:1.45">${i.title}</div>
            <div class="meta">${i.source}${time ? ' • ' + time : ''}</div>
          </a>
        `;
        list.appendChild(li);
      });

      if (!list.children.length) {
        list.innerHTML = '<li>لا توجد عناصر متاحة الآن.</li>';
      }
    } catch (e) {
      console.error(e);
      const list = document.getElementById('news-list');
      list.innerHTML = '<li>تعذّر تحميل الأخبار الآن.</li>';
    }
  }
  loadNewsPage();
  </script>
</body>
</html>
