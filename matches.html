<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„Ø¯ÙˆØ±ÙŠØ§Øª Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</title>
  <link rel="stylesheet" href="assets/style.css"/>
  <style>
    .tabs { display:flex; gap:8px; flex-wrap:wrap; margin:16px 0; }
    .tab-btn { padding:8px 12px; border:1px solid #006c35; background:#fff; color:#006c35; border-radius:10px; cursor:pointer }
    .tab-btn.active { background:#006c35; color:#fff }
    .match { border:1px solid #eee; border-radius:10px; padding:10px; margin:8px 0; }
    .row { display:flex; justify-content:space-between; align-items:center; }
    .muted { font-size:12px; color:#666 }
  </style>
</head>
<body>
  <section class="card" style="margin:20px">
    <h2>ğŸ“… Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„Ø¯ÙˆØ±ÙŠØ§Øª Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</h2>

    <div class="tabs">
      <button class="tab-btn active" data-league="pro">Ø¯ÙˆØ±ÙŠ Ø±ÙˆØ´Ù†</button>
      <button class="tab-btn" data-league="first">Ø¯ÙˆØ±ÙŠ ÙŠÙ„Ùˆ</button>
      <button class="tab-btn" data-league="kings">ÙƒØ£Ø³ Ø§Ù„Ù…Ù„Ùƒ</button>
      <button class="tab-btn" data-league="super">ÙƒØ£Ø³ Ø§Ù„Ø³ÙˆØ¨Ø±</button>
    </div>

    <div style="display:flex; gap:10px; align-items:center; margin-bottom:10px">
      <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ±:</label>
      <select id="limitSel" class="tab-btn" style="border:1px solid #ccc;color:#333">
        <option value="4">4</option>
        <option value="8" selected>8</option>
        <option value="12">12</option>
      </select>

      <label>Ø§Ù„Ù†ÙˆØ¹:</label>
      <select id="typeSel" class="tab-btn" style="border:1px solid #ccc;color:#333">
        <option value="both" selected>Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© + Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</option>
        <option value="past">Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</option>
        <option value="next">Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</option>
      </select>
    </div>

    <div id="updated" class="muted">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: â€”</div>
    <div id="leagueName" style="margin-top:8px;font-weight:bold">â€”</div>

    <div id="list" style="margin-top:10px">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦</div>
  </section>

  <script>
    const list = document.getElementById("list");
    const updated = document.getElementById("updated");
    const leagueName = document.getElementById("leagueName");
    const limitSel = document.getElementById("limitSel");
    const typeSel = document.getElementById("typeSel");
    let currentLeague = "pro";

    function block(title, arr, isPast) {
      if(!arr || !arr.length) return "";
      return `
        <div style="margin-top:14px;font-weight:700">${title}</div>
        ${arr.map(m => `
          <div class="match">
            <div class="row">
              <span>${m.home}</span>
              <strong>${isPast && m.homeScore!=null && m.awayScore!=null ? `${m.homeScore} - ${m.awayScore}` : "VS"}</strong>
              <span>${m.away}</span>
            </div>
            <div class="muted">
              ğŸŸï¸ ${m.venue || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯"} |
              ğŸ“… ${m.dateLocal || m.date || "â€”"} |
              â° ${m.timeLocal || m.time || "â€”"}
            </div>
          </div>
        `).join("")}
      `;
    }

    async function load() {
      list.textContent = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦";
      const qs = new URLSearchParams({
        league: currentLeague,
        limit: limitSel.value,
        type: typeSel.value
      }).toString();

      try {
        const res = await fetch(`/.netlify/functions/saudi-matches?${qs}`, { cache: "no-store" });
        if(!res.ok) throw new Error("Function error");
        const data = await res.json();
        leagueName.textContent = data.league?.name || "â€”";
        updated.textContent = "Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: " + new Date(data.updated_at).toLocaleString("ar-SA");

        let html = "";
        if (typeSel.value === "both" || typeSel.value === "past") {
          html += block("Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©", data.past, true);
        }
        if (typeSel.value === "both" || typeSel.value === "next") {
          html += block("Ø§Ù„Ù…Ø¨Ø§Ø±ÙŠØ§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©", data.next, false);
        }
        list.innerHTML = html || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª.";
      } catch (e) {
        console.error(e);
        list.textContent = "Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª.";
      }
    }

    document.querySelectorAll(".tab-btn[data-league]").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll(".tab-btn[data-league]").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        currentLeague = btn.dataset.league;
        load();
      });
    });
    limitSel.addEventListener("change", load);
    typeSel.addEventListener("change", load);

    load();
  </script>
</body>
</html>
