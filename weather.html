<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>الطقس في مناطق السعودية</title>

  <!-- ستايل موقعك العام (يظل شغال لكن لن يتعارض) -->
  <link rel="stylesheet" href="styles.css">

  <!-- ADDED: AdSense (إعلانات تلقائية) -->
  <meta name="google-adsense-account" content="ca-pub-6286972152122784"><!-- ADDED -->
  <script async crossorigin="anonymous" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6286972152122784"></script><!-- ADDED -->

  <!-- ADDED: SEO أساسي -->
  <link rel="canonical" href="https://as3aralywm.com/weather"><!-- ADDED -->
  <meta name="description" content="حالة الطقس الآن في مناطق ومدن السعودية مع درجة الحرارة ووصف الحالة لكل مدينة."><!-- ADDED -->
  <meta name="format-detection" content="telephone=no"><!-- ADDED -->
  <meta name="theme-color" content="#0f172a"><!-- ADDED -->
  <meta property="og:type" content="website"><!-- ADDED -->
  <meta property="og:locale" content="ar_SA"><!-- ADDED -->
  <meta property="og:title" content="الطقس في مناطق المملكة — درجات الحرارة الآن"><!-- ADDED -->
  <meta property="og:description" content="تصفح حالة الطقس في جميع مناطق ومدن السعودية مع تحديث مباشر من Open-Meteo."><!-- ADDED -->
  <meta property="og:url" content="https://as3aralywm.com/weather"><!-- ADDED -->
  <meta property="og:image" content="/assets/og-cover.jpg"><!-- ADDED -->
  <meta name="twitter:card" content="summary_large_image"><!-- ADDED -->

  <style>
    /* ====== Weather App Namespace ====== */
    #wx-app { --bg:#0f172a; --text:#e5e7eb; --muted:#9ca3af; --card:#111827; --border:#374151; --accent:#4ade80; }
    #wx-app, #wx-app * { box-sizing: border-box; }
    #wx-app { background:var(--bg); color:var(--text); min-height:100dvh; }

    #wx-app .wx-container { max-width:1200px; margin-inline:auto; padding:20px; }
    #wx-app h1 { font-size:28px; margin:0 0 8px; }
    #wx-app .wx-sub { color:var(--muted); margin-bottom:18px; }

    #wx-app .wx-toolbar { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:16px; }
    #wx-app .wx-search { flex:1; min-width:260px; }
    #wx-app .wx-input {
      width:100%; padding:10px 12px; border-radius:10px; border:1px solid var(--border);
      background:var(--card); color:var(--text);
    }
    #wx-app .wx-btn {
      padding:10px 14px; border-radius:10px; border:1px solid var(--border);
      background:var(--card); color:var(--text); cursor:pointer;
    }
    #wx-app .wx-btn:hover { border-color:#4b5563; }

    #wx-app .wx-region { background:var(--card); border:1px solid var(--border); border-radius:14px; margin-bottom:12px; overflow:hidden; }
    #wx-app .wx-region-h {
      display:flex; align-items:center; gap:10px; justify-content:space-between; padding:14px 16px; cursor:pointer;
    }
    #wx-app .wx-region-title { font-weight:800; }
    #wx-app .wx-count { color:var(--muted); font-size:14px; }
    #wx-app .wx-chev { transition:.15s; }
    #wx-app .wx-region.wx-open .wx-chev { transform:rotate(180deg); }

    #wx-app .wx-cities { display:none; border-top:1px solid var(--border); padding:14px; }
    #wx-app .wx-region.wx-open .wx-cities { display:block; }

    #wx-app .wx-cities-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(220px,1fr)); gap:12px; }

    #wx-app .wx-card {
      background:#0f172a; border:1px solid var(--border); border-radius:12px;
      padding:12px; display:flex; gap:10px; align-items:center; transition:.15s;
    }
    #wx-app .wx-card:hover { transform:translateY(-2px); box-shadow:0 10px 18px rgba(0,0,0,.18); }

    #wx-app .wx-city { font-weight:700; }
    #wx-app .wx-muted { color:var(--muted); font-size:14px; }
    #wx-app .wx-emoji { font-size:28px; }

    #wx-app .wx-skeleton{background:linear-gradient(90deg,#0b1222 25%,#10192f 37%,#0b1222 63%);background-size:400% 100%;animation:wxs 1.2s ease-in-out infinite}
    @keyframes wxs{0%{background-position:100% 50%}100%{background-position:0 50%}}

    #wx-app .wx-footer { margin-top:20px; color:var(--muted); font-size:12px; }
    #wx-app a { color:var(--accent); text-decoration:none; }
    #wx-app a:hover { text-decoration:underline; }

    /* منع أي Grid/Sidebar عام من الموقع يخرّب العرض داخل صفحة الطقس */
    #wx-app { display:block; width:100%; }
  </style>

  <!-- (اختياري) Google Analytics مثل باقي الصفحات -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-D8W8C8PYS9"></script>
  <script>
    window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}
    gtag('js', new Date()); gtag('config','G-D8W8C8PYS9');
  </script>

  <!-- ADDED: Structured Data لرفع جودة الصفحة -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"Article",
    "headline":"الطقس في مناطق السعودية",
    "inLanguage":"ar",
    "author":{"@type":"Organization","name":"أسعار اليوم السعودية"},
    "publisher":{"@type":"Organization","name":"أسعار اليوم السعودية"},
    "mainEntityOfPage":{"@type":"WebPage","@id":"https://as3aralywm.com/weather"}
  }
  </script>
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"من أين نجلب بيانات الطقس؟","acceptedAnswer":{"@type":"Answer","text":"نستخدم واجهة Open-Meteo العامة لقراءة الطقس الحالي لكل مدينة."}},
      {"@type":"Question","name":"هل الزمن والتوقيت محلي؟","acceptedAnswer":{"@type":"Answer","text":"نستخدم timezone=auto من Open-Meteo لعرض القيم حسب التوقيت المحلي قدر الإمكان."}},
      {"@type":"Question","name":"لماذا تختلف الحالة بين التطبيقات؟","acceptedAnswer":{"@type":"Answer","text":"تختلف مصادر النماذج والرصد بين الخدمات؛ نعرض وصفًا عامًّا ودرجة الحرارة الحالية."}}
    ]
  }
  </script>
</head>
<body>
  <div id="wx-app" dir="rtl" lang="ar">
    <div class="wx-container">
      <h1>الطقس في مناطق المملكة</h1>
      <div class="wx-sub">اختر المنطقة لعرض حالة الطقس في مدنها ومحافظاتها.</div>

      <div class="wx-toolbar">
        <div class="wx-search"><input id="wx-q" class="wx-input" placeholder="ابحث باسم مدينة أو محافظة…" /></div>
        <button id="wx-expandAll" class="wx-btn">فتح الكل</button>
        <button id="wx-collapseAll" class="wx-btn">إغلاق الكل</button>
      </div>

      <!-- ADDED: قسم تحليلي بسيط لزيادة قيمة الصفحة -->
      <section class="wx-region" style="padding:12px;border-radius:14px"><!-- ADDED -->
        <div class="wx-region-h" style="cursor:default" aria-hidden="true"><!-- ADDED -->
          <div class="wx-region-title">ملخص سريع</div><!-- ADDED -->
        </div><!-- ADDED -->
        <div class="wx-cities" style="display:block;padding:12px"><!-- ADDED -->
          <p class="wx-muted" style="margin:0">تختلف الأحوال بين السواحل (جدة/ينبع) والداخل (الرياض/حائل) والمرتفعات (أبها/النماص). راقب رموز الحالة والحرارة المذكورة لكل مدينة.</p><!-- ADDED -->
        </div><!-- ADDED -->
      </section><!-- ADDED -->

      <div id="wx-regions"></div>

      <div class="wx-footer">المصدر: <a href="https://open-meteo.com/" target="_blank" rel="noopener">Open-Meteo</a></div>
    </div>
  </div>

  <noscript><!-- ADDED -->
    <div style="max-width:1200px;margin:12px auto;color:#555;padding:12px">
      تحتاج هذه الصفحة إلى تمكين JavaScript لجلب حالة الطقس لكل مدينة.
    </div>
  </noscript><!-- ADDED -->

  <script>
    const WMO = {
      0:['صافٍ','☀️'],1:['غالبًا صافٍ','🌤️'],2:['غائم جزئيًا','⛅'],3:['غائم','☁️'],
      45:['ضباب','🌫️'],48:['ضباب متجمد','🌫️'],
      51:['رذاذ خفيف','🌦️'],53:['رذاذ متوسط','🌦️'],55:['رذاذ غزير','🌧️'],
      61:['مطر خفيف','🌦️'],63:['مطر متوسط','🌧️'],65:['مطر غزير','🌧️'],
      66:['مطر متجمد خفيف','🌧️'],67:['مطر متجمد غزير','🌧️'],
      71:['ثلج خفيف','🌨️'],73:['ثلج متوسط','🌨️'],75:['ثلج غزير','❄️'],
      77:['حبات ثلج','❄️'],80:['زخات خفيفة','🌦️'],81:['زخات مطر','🌧️'],82:['زخات غزيرة','⛈️'],
      85:['زخات ثلج خفيفة','🌨️'],86:['زخات ثلج غزيرة','❄️'],
      95:['عواصف رعدية','⛈️'],96:['عواصف مع برد خفيف','⛈️'],99:['عواصف مع برد غزير','⛈️']
    };

    const SA_REGIONS = [
      { name:'الرياض', cities:[
        ['الرياض',24.7136,46.6753],['الخرج',24.1483,47.3050],['الدلم',23.9907,47.1597],
        ['المزاحمية',24.4703,46.2669],['القويعية',24.0667,45.2800],['وادي الدواسر',20.3833,45.1167],
        ['الأفلاج (ليلى)',22.2825,46.7314],['الزلفي',26.2992,44.8159],['شقراء',25.2583,45.2450],['رماح',25.2428,47.1608]
      ]},
      { name:'مكة المكرمة', cities:[
        ['مكة',21.3891,39.8579],['جدة',21.4858,39.1925],['الطائف',21.2703,40.4158],
        ['الليث',20.1500,40.2667],['القنفذة',19.1264,41.0789],['رابغ',22.7986,39.0349],
        ['الجموم',21.7187,39.6956],['خليص',22.2931,39.2676],['الخرمة',21.9148,42.0213]
      ]},
      { name:'المدينة المنورة', cities:[
        ['المدينة',24.5247,39.5692],['ينبع',24.0895,38.0618],['العلا',26.6167,37.9167],
        ['بدر',23.7819,38.7906],['خيبر',25.6944,39.2708]
      ]},
      { name:'الشرقية', cities:[
        ['الدمام',26.4207,50.0888],['الخبر',26.2172,50.1971],['الظهران',26.2883,50.1130],
        ['الأحساء (الهفوف)',25.3833,49.5833],['الجبيل',27.0049,49.6582],['القطيف',26.5202,50.0246],
        ['حفر الباطن',28.4328,45.9700],['بقيق',25.9333,49.6667],['رأس تنورة',26.7081,50.0619],['النعيرية',27.4833,48.4833]
      ]},
      { name:'القصيم', cities:[
        ['بريدة',26.3591,43.9819],['عنيزة',26.0840,43.9939],['الرس',25.8694,43.4973],
        ['المذنب',25.8601,44.2228],['البدائع',26.3270,43.6575],['البكيرية',26.1451,43.6590],['النبهانية',25.8500,43.0500],['عيون الجواء',26.2447,43.4950]
      ]},
      { name:'عسير', cities:[
        ['أبها',18.2465,42.5117],['خميس مشيط',18.3064,42.7290],['محايل',18.5500,42.0500],
        ['رجال ألمع',18.2000,42.3000],['بيشة',19.9833,42.6000],['ظهران الجنوب',17.9442,43.5125],
        ['سراة عبيدة',18.0742,43.1496],['النماص',19.1460,42.1240],['تنومة',19.1333,42.1333]
      ]},
      { name:'حائل', cities:[
        ['حائل',27.5114,41.7208],['الغزالة',27.4400,41.0000],['الشنان',27.1600,42.0000],['الشملي',27.3200,40.9000]
      ]},
      { name:'تبوك', cities:[
        ['تبوك',28.3833,36.5833],['الوجه',26.2455,36.4525],['ضباء',27.3513,35.7020],
        ['أملج',25.0670,37.2610],['حقل',29.2807,34.9522],['تيماء',27.6343,38.5469]
      ]},
      { name:'جازان', cities:[
        ['جازان',16.8892,42.5706],['صامطة',16.6113,42.9440],['أحد المسارحة',16.7000,42.9500],
        ['أبو عريش',16.9667,42.8333],['صبيا',17.1500,42.6333],['بيش',17.4500,42.5500],
        ['الدرب',17.7188,42.2398],['العارضة',17.0956,43.1495],['فرسان',16.7000,42.1160]
      ]},
      { name:'نجران', cities:[
        ['نجران',17.4924,44.1277],['شرورة',17.4679,47.1336],['حبونا',17.4050,44.5450],['بدر الجنوب',17.9080,44.5400],['يدمة',18.0000,44.6000]
      ]},
      { name:'الباحة', cities:[
        ['الباحة',20.0129,41.4677],['بلجرشي',19.8997,41.5439],['المندق',20.1986,41.3010],
        ['المخواة',19.9954,41.4443],['قلوة',19.4449,41.2811],['العقيق',20.2760,41.6647]
      ]},
      { name:'الجوف', cities:[
        ['سكاكا',29.9697,40.2064],['القريات',31.3300,37.3433],['دومة الجندل',29.8100,39.8600],['طبرجل',30.5000,38.2167]
      ]},
      { name:'الحدود الشمالية', cities:[
        ['عرعر',30.9800,41.0380],['رفحاء',29.6203,43.4946],['طريف',31.6772,38.6637],['العويقيلة',30.3600,43.6500]
      ]}
    ];

    const $regions = document.getElementById('wx-regions');
    const $q = document.getElementById('wx-q');

    async function fetchWeather(lat, lon){
      const u = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,weather_code&timezone=auto`;
      const r = await fetch(u);
      if(!r.ok) throw new Error('fetch failed');
      return r.json();
    }

    function renderRegion(region){
      const el = document.createElement('section');
      el.className = 'wx-region';
      el.innerHTML = `
        <div class="wx-region-h" role="button" aria-expanded="false">
          <div>
            <div class="wx-region-title">${region.name}</div>
            <div class="wx-count">${region.cities.length} مدن/محافظة</div>
          </div>
          <div class="wx-chev">▼</div>
        </div>
        <div class="wx-cities"><div class="wx-cities-grid"></div></div>
      `;
      const head = el.querySelector('.wx-region-h');
      const grid = el.querySelector('.wx-cities-grid');

      head.addEventListener('click', async () => {
        const opened = el.classList.toggle('wx-open');
        head.setAttribute('aria-expanded', opened ? 'true' : 'false');
        if (opened && !grid.dataset.loaded){
          region.cities.forEach(([city])=>{
            const c = document.createElement('div');
            c.className='wx-card';
            c.innerHTML = `<div class="wx-emoji wx-skeleton" style="width:32px;height:32px;border-radius:8px"></div>
                           <div><div class="wx-city">${city}</div><div class="wx-muted">جاري الجلب…</div></div>`;
            grid.appendChild(c);
          });
          const cards = grid.querySelectorAll('.wx-card');
          await Promise.all(region.cities.map(async ([city,lat,lon],i)=>{
            try{
              const data = await fetchWeather(lat,lon);
              const t = Math.round(data.current.temperature_2m);
              const code = data.current.weather_code;
              const [desc, emoji] = WMO[code] || ['غير متاح','⛅'];
              cards[i].querySelector('.wx-emoji').textContent = emoji;
              cards[i].querySelector('.wx-emoji').classList.remove('wx-skeleton');
              cards[i].querySelector('.wx-muted').textContent = `${t}° م — ${desc}`;
            }catch(e){
              cards[i].querySelector('.wx-muted').textContent = 'تعذّر الجلب';
            }
          }));
          grid.dataset.loaded = '1';
        }
      });

      return el;
    }

    SA_REGIONS.forEach(r => $regions.appendChild(renderRegion(r)));

    $q.addEventListener('input', () => {
      const q = $q.value.trim();
      const terms = q ? q.split(/\s+/) : [];
      [...$regions.children].forEach((sec, idx)=>{
        const region = SA_REGIONS[idx];
        const match = !terms.length || region.cities.some(([name]) => terms.every(t=>name.includes(t)));
        sec.style.display = match ? '' : 'none';
        if (q && match && !sec.classList.contains('wx-open')) sec.querySelector('.wx-region-h').click();
      });
    });

    document.getElementById('wx-expandAll').onclick = () => {
      [...$regions.children].forEach(sec => { if(!sec.classList.contains('wx-open')) sec.querySelector('.wx-region-h').click(); });
    };
    document.getElementById('wx-collapseAll').onclick = () => {
      [...$regions.children].forEach(sec => { if(sec.classList.contains('wx-open')) sec.querySelector('.wx-region-h').click(); });
    };
  </script>
</body>
</html>
